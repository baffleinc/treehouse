/*! ScrollMagic v2.0.0 | (c) 2015 Jan Paepke (@janpaepke) | license & info: http://janpaepke.github.io/ScrollMagic */
!function(e,n){"function"==typeof define&&define.amd?define(["ScrollMagic","TweenMax","TimelineMax"],n):n(e.ScrollMagic||e.jQuery&&e.jQuery.ScrollMagic,e.TweenMax||e.TweenLite,e.TimelineMax||e.TimelineLite)}(this,function(e,n,t){"use strict";e.Scene.addOption("tweenChanges",!1,function(e){return!!e}),e.Scene.extend(function(){var e,r=this;r.on("progress.plugin_gsap",function(){i()}),r.on("destroy.plugin_gsap",function(e){r.removeTween(e.reset)});var i=function(){if(e){var n=r.progress(),t=r.state();e.repeat&&-1===e.repeat()?"DURING"===t&&e.paused()?e.play():"DURING"===t||e.paused()||e.pause():n!=e.progress()&&(0===r.duration()?n>0?e.play():e.reverse():r.tweenChanges()&&e.tweenTo?e.tweenTo(n*e.duration()):e.progress(n).pause())}};r.setTween=function(o,a,s){var u;arguments.length>1&&(arguments.length<3&&(s=a,a=1),o=n.to(o,a,s));try{u=t?new t({smoothChildTiming:!0}).add(o):o,u.pause()}catch(p){return r}return e&&r.removeTween(),e=u,o.repeat&&-1===o.repeat()&&(e.repeat(-1),e.yoyo(o.yoyo())),i(),r},r.removeTween=function(n){return e&&(n&&e.progress(0).pause(),e.kill(),e=void 0),r}})}),angular.module("previewGrid",["ngAnimate","duScroll"]).directive("previewGrid",function($window,$previewProvider,$timeout,$rootScope){return{template:'<ul class="grid"><preview-item ng-repeat="item in items" item="item"></preview-item></ul>',restrict:"E",replace:!0,scope:{items:"="},link:function(){var resizeTimer;angular.element($window).on("resize",function(){"undefined"!=typeof $previewProvider.$instance&&($previewProvider.$instance.close(),$previewProvider.current=-1),$previewProvider.getWinsize(),$timeout.cancel(resizeTimer),resizeTimer=$timeout(function(){$rootScope.$broadcast("resizeOver")},1e3)})}}}).directive("previewItem",function($previewProvider,$preview,$window,$rootScope){return{template:'<li><a ng-href="{{item.fallbackUrl}}" image-loaded><img ng-src="{{ item.preview | trustUrl }}" alt=""></a></li>',restrict:"E",replace:!0,scope:{item:"="},link:function(scope,element){$previewProvider.items.push(element);var index=scope.$parent.$index,link=element.find("a"),setHeights=function(){element.css("height",element[0].offsetWidth+"px"),element.data("offsetTop",element[0].offsetTop),element.data("height",element[0].offsetWidth)};setHeights(),$rootScope.$on("resizeOver",function(){setHeights()}),link.on("click",function(evt){evt.preventDefault(),$previewProvider.current===index?hidePreview():showPreview()});var showPreview=function(){var position=element.data("offsetTop");if("undefined"!=typeof $previewProvider.$instance){if(console.log("instance exists"),$previewProvider.$instance.position===position)return console.log("same row"),$previewProvider.$instance.update(element),!1;console.log("not same row"),hidePreview()}else console.log("instance does't exists");$previewProvider.$instance=new $preview(index),$previewProvider.$instance.position=position,$previewProvider.$instance.open()},hidePreview=function(){$previewProvider.current=-1,$previewProvider.$instance.close()}}}}).directive("previewPane",function($previewProvider){return{template:'<div class="expander"><a ng-click="close()" class="close" title="close"></a><div class="inner"><div class="left"><h3>{{content.title}}</h3><p>{{content.description}}</p></div><div class="right"><img ng-src="{{image.url | trustUrl}}" alt="" ng-repeat="image in content.images" image-loaded></div></div></div>',restrict:"E",replace:!0,link:function(scope){scope.close=function(){$previewProvider.$instance.close()}}}}).directive("imageLoaded",function(){return{restrict:"A",scope:{imageLoaded:"&"},link:function(scope,element){"img"==element.tagName?element.bind("load",function(){element.addClass("imageLoaded")}):element.find("img").bind("load",function(){element.addClass("imageLoaded")})}}}).service("$previewProvider",function($window){var templateUrl,winsize,items=[],current=-1,scrollExtra=0,settings={minHeight:500,speed:350,easing:"ease"},getWinsize=function(){winsize={width:$window.innerWidth,height:$window.innerHeight}};return getWinsize(),{templateUrl:templateUrl,items:items,winsize:winsize,getWinsize:getWinsize,current:current,scrollExtra:scrollExtra,settings:settings}}).factory("$preview",function($previewProvider,$compile,$timeout,$rootScope,$animate,$document,$q){var Preview=function(index){this.$item=$previewProvider.items[index],this.position=0,this.index=index,this.create(),this.update()};return Preview.prototype={create:function(){var template=angular.element("<preview-pane></preview-pane>");this.newScope=$previewProvider.scope||$rootScope.$new(),this.newScope.content=this.$item.scope().item.content,this.$previewEl=$compile(template)(this.newScope),this.$item.append(this.$previewEl),this.setTransition()},update:function(item){if(item&&(this.$item=item,this.newScope.content=item.scope().item.content,this.newScope.$apply()),-1!==$previewProvider.current){var $currentItem=$previewProvider.items[$previewProvider.current];$currentItem.removeClass("expanded"),this.$item.addClass("expanded"),this.positionPreview()}$previewProvider.current=this.$item.scope().$index},open:function(){var self=this;$timeout(function(){self.setHeights(),self.positionPreview()},25)},close:function(){var self=this,def=$q.defer();return $timeout(function(){var $expandedItem=$previewProvider.items[self.index];$animate.removeClass($expandedItem,"expanded-animate",{to:{height:$expandedItem.data("height")+"px"}}),$animate.removeClass(self.$previewEl,"preview-expanded",{to:{height:0}}).then(function(){self.$item.removeClass("expanded"),self.$previewEl.remove(),$previewProvider.$instance.position=-1})},25),def.promise},calcHeight:function(){var previewHeight=$previewProvider.winsize.height-this.$item.data("height"),itemHeight=$previewProvider.winsize.height;previewHeight<$previewProvider.settings.minHeight&&(previewHeight=$previewProvider.settings.minHeight,itemHeight=$previewProvider.settings.minHeight+this.$item.data("height")),this.height=previewHeight,this.itemHeight=itemHeight},setHeights:function(){this.calcHeight(),$animate.addClass(this.$item,"expanded-animate",{to:{height:this.itemHeight+"px"}}),$animate.addClass(this.$previewEl,"preview-expanded",{to:{height:this.height+"px"}}),this.$item.addClass("expanded")},positionPreview:function(){var position=this.$item.data("offsetTop"),previewOffsetT=this.$previewEl[0].offsetTop,scrollVal=this.height+this.$item.data("height")<=$previewProvider.winsize.height?position:this.height<$previewProvider.winsize.height?previewOffsetT-($previewProvider.winsize.height-this.height):previewOffsetT;$document.scrollTopAnimated(scrollVal)},setTransition:function(){var transitionString="height "+$previewProvider.settings.speed+"ms "+$previewProvider.settings.easing;this.$previewEl.css("transition",transitionString),this.$item.css("transition",transitionString)}},Preview}).filter("trustUrl",function($sce){return function(input){return $sce.trustAsResourceUrl(input)}}),angular.module("treehouse",["hamburgerHelper","ngTouch","duScroll","previewGrid"]).controller("MainController",function($scope,$window){if(!Modernizr.touch){var windowHeight=$window.innerHeight,smController=new ScrollMagic.Controller,logoTop=windowHeight+140+"px";new ScrollMagic.Scene({duration:windowHeight-80}).setTween("#hero__logo",.5,{top:logoTop,width:"80px",marginLeft:"-40px",transform:"rotateY(0deg)"}).addTo(smController),new ScrollMagic.Scene({duration:windowHeight/2}).setTween("#treehouse",.5,{opacity:0,marginTop:"-100px"}).addTo(smController),new ScrollMagic.Scene({duration:windowHeight/2}).setTween("#studios",.5,{marginTop:"-150px",opacity:0}).addTo(smController)}$scope.items=[{preview:"images/preview.jpg",fallbackUrl:"http://google.com",content:{title:"SOMETHING",description:"blah blah blah",images:[{url:"images/preview.jpg"},{url:"images/preview1.jpg"},{url:"images/preview2.jpg"},{url:"images/preview3.jpg"},{url:"images/preview4.jpg"}]}},{preview:"images/preview1.jpg",fallbackUrl:"http://google.com",content:{title:"SOMETHING2",description:"blah blah blah",images:[{url:"images/preview.jpg"},{url:"images/preview1.jpg"},{url:"images/preview2.jpg"},{url:"images/preview3.jpg"},{url:"images/preview4.jpg"}]}},{preview:"images/preview2.jpg",fallbackUrl:"http://google.com",content:{title:"SOMETHING3",description:"blah blah blah",images:[{url:"images/preview.jpg"},{url:"images/preview1.jpg"},{url:"images/preview2.jpg"},{url:"images/preview3.jpg"},{url:"images/preview4.jpg"}]}},{preview:"images/preview3.jpg",fallbackUrl:"http://google.com",content:{title:"SOMETHING4",description:"blah blah blah",images:[{url:"images/preview.jpg"},{url:"images/preview1.jpg"},{url:"images/preview2.jpg"},{url:"images/preview3.jpg"},{url:"images/preview4.jpg"}]}},{preview:"images/preview4.jpg",fallbackUrl:"http://google.com",content:{title:"SOMETHING",description:"blah blah blah",images:[{url:"images/preview.jpg"},{url:"images/preview1.jpg"},{url:"images/preview2.jpg"},{url:"images/preview3.jpg"},{url:"images/preview4.jpg"}]}},{preview:"images/preview1.jpg",fallbackUrl:"http://google.com",content:{title:"SOMETHING2",description:"blah blah blah",images:[{url:"images/preview.jpg"},{url:"images/preview1.jpg"},{url:"images/preview2.jpg"},{url:"images/preview3.jpg"},{url:"images/preview4.jpg"}]}},{preview:"images/preview3.jpg",fallbackUrl:"http://google.com",content:{title:"SOMETHING3",description:"blah blah blah",images:[{url:"images/preview.jpg"},{url:"images/preview1.jpg"},{url:"images/preview2.jpg"},{url:"images/preview3.jpg"},{url:"images/preview4.jpg"}]}},{preview:"images/preview4.jpg",fallbackUrl:"http://google.com",content:{title:"SOMETHING4",description:"blah blah blah",images:[{url:"images/preview.jpg"},{url:"images/preview1.jpg"},{url:"images/preview2.jpg"},{url:"images/preview3.jpg"},{url:"images/preview4.jpg"}]}}]}).directive("stickyHeader",function($document,$window,Interface){return{restrict:"AC",link:function(scope,el){var elScroll=el[0].offsetTop;$document.on("scroll",function(){var docScroll=document.body.scrollTop;docScroll>=elScroll?(el.addClass("stick"),Interface.logo.addClass("hide").removeClass("animation")):elScroll>docScroll&&(el.removeClass("stick"),Interface.logo.removeClass("hide"))})}}}).directive("logo",function($document,Interface){return{restrict:"AC",link:function(scope,el){Interface.logo=el}}}).service("Interface",function(){var Interface={logo:{}};return Interface});